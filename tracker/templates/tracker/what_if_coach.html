{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>üå∏ Hello Kitty Fitness üå∏</title>
  <link rel="stylesheet" href="{% static 'tracker/css/what_if_coach.css' %}">
  <!--font Modak and DynaPuff-->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Alfa+Slab+One&family=DynaPuff:wght@400..700&family=Maven+Pro:wght@400..900&family=Modak&family=Rubik+Bubbles&family=Sigmar+One&display=swap"
    rel="stylesheet">
</head>

<body>
  <script>
  function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== "") {
          const cookies = document.cookie.split(";");
          for (let cookie of cookies) {
              cookie = cookie.trim();
              if (cookie.startsWith(name + "=")) {
                  cookieValue = cookie.substring(name.length + 1);
                  break;
              }
          }
      }
      return cookieValue;
  }
  </script>

  <div id="aboutPopup" class="popup-overlay">
    <div class="popup-box">
      <div class="popup-inner">
        <h2 class="popup-title">About us</h2>
        <p class="popup-desc">
          Beautiful and passionate souls converge to create Kitty Fitness - 
          a space where technology meets emotion, radiating the energy of love and warmth üíñ
        </p>

        <ul class="popup-members">
          <li>11245870 ‚Äì Nguy·ªÖn Kh√°nh Duy</li>
          <li>11245886 ‚Äì Tr·∫ßn Th·ªã Nh·∫≠t Kh√°nh</li>
          <li>11245840 ‚Äì V≈© ƒê·ª©c Anh</li>
          <li>11245892 ‚Äì L√™ Ph·∫°m Kh√°nh Linh</li>
          <li>11245921 ‚Äì Ho√†ng Th·ª•c Nhi</li>
          <li>11245899 ‚Äì V≈© Tr·∫ßn C√°t Linh</li>
        </ul>

        <img class="kitty-left" src="{% static 'tracker/images/pop-up1.png' %}">
        <img class="kitty-right" src="{% static 'tracker/images/pop-up2.png' %}">
      </div>
    </div>
  </div>

  <!-- Header -->
  <header>
    <div class="logo">
      <img src={% static 'tracker/images/gif3.gif' %} alt="Kitty Logo">
      <h1>Kitty Fitness</h1>
    </div>
    <nav>
      <div class="dropdown">
        <a href="#" class="features-btn">Features ‚ñæ</a>
        <div class="dropdown-content">
            <a href="{% url 'weekly_plan_generator' %}">Weekly Workout Plan</a>
            <a href="{% url 'goal_translator' %}">Goal-to-Workout</a>
            <a href="{% url 'class_picker' %}">Workout Class Finder</a>
            <a href="{% url 'what_if_coach' %}">What-If Fitness Coach</a>
            <a href="{% url 'calorie_swap' %}">Calorie Burn Swap</a>
            <a href="{% url 'meal_suggest' %}">Smart Meal Suggestion</a>
        </div>
      </div>
      <a href="#" id="aboutBtn">About us</a>
    </nav>
  </header>

  <!--S·ª≠a ·ªü ƒë√¢y-->
  <div class="main-container">
    <div class="prediction-box">
      <h2 class="section-title">üèãÔ∏è What-if Coach ‚Äì Predict Your Energy Burn ü§∏</h2>
      <p class="section-desc">
        Enter your workout details and let Hello Kitty show you how much energy
        you burned today! üí™‚ú®
      </p>
      <div class="underline"></div>

      <form id="burnPredictionForm">
        <div class="input-group-custom">
          <label for="duration">Workout duration today (minutes):</label>
          <input type="number" id="duration" name="duration" required>
        </div>
        <div class="input-group-custom">
          <label for="heartrate">Average heart rate during workout (bpm):</label>
          <input type="number" id="heartrate" name="heartrate" required>
        </div>

        <button type="submit" class="calculate-btn">Calculate now</button>
      </form>
    </div>
  </div>

  <div id="resultPopup" class="popup-overlay">
    <div class="popup-box result-popup-box">
      <div class="popup-inner">
        <img src="{% static 'tracker/images/gif2.gif' %}" class="result-gif">

        <h2 class="popup-title-result">Your Burn Result</h2>
        <p id="resultText" class="popup-desc-result"></p>

        <button id="closeResultBtn" class="close-result-btn">Close</button>
      </div>
    </div>
  </div>

  <script>
    const aboutBtn = document.getElementById("aboutBtn");
    const aboutPopup = document.getElementById("aboutPopup");
    const popupBox = document.querySelector(".popup-box");

    // m·ªü popup
    aboutBtn.addEventListener("click", () => {
      aboutPopup.style.display = "flex";
    });

    // click ngo√†i popup ƒë·ªÉ t·∫Øt
    aboutPopup.addEventListener("click", (e) => {
      if (!popupBox.contains(e.target)) {
        aboutPopup.style.display = "none";
      }
    });
  </script>

  <script>
    document.getElementById("burnPredictionForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      const formData = new FormData();
      formData.append("duration", document.getElementById("duration").value);
      formData.append("heartrate", document.getElementById("heartrate").value);

      const res = await fetch("/api/what-if/", {
          method: "POST",
          body: formData,
          headers: {
              "X-CSRFToken": getCookie("csrftoken")
          }
      });

      const data = await res.json();

      if (data.error) {
          alert(data.error);
          return;
      }

      const resultPopup = document.getElementById("resultPopup");

      // Hi·ªÉn th·ªã k·∫øt qu·∫£
      document.getElementById("resultText").innerHTML =
          `üî• You burned about <b>${data.predicted} kcal</b> today!`;

      resultPopup.style.display = "flex";
  });
  </script>

  <script>
    document.getElementById("closeResultBtn").addEventListener("click", () => {
      const resultPopup = document.getElementById("resultPopup");
      resultPopup.style.display = "none";

      window.scrollTo({
        top: 0,
        behavior: "smooth"
      });
    });
  </script>

  <script>
  setInterval(() => {
      const gif = document.querySelector(".result-gif");
      if (gif) {
          const src = gif.src;
          gif.src = "";   // clear source
          gif.src = src;  // reload GIF to restart animation
      }
  }, 4000); // reset m·ªói 4 gi√¢y (ch·ªânh t√πy GIF d√†i hay ng·∫Øn)
  </script>

  <script>
  document.getElementById("resultPopup").addEventListener("transitionstart", () => {
      const gif = document.querySelector(".result-gif");
      gif.src = gif.src;
  });
  </script>

</body>

</html>